<!DOCTYPE html>
<html>
<head>
	<title>Blokus</title>
	<style>
		table {
		  border-collapse: collapse;
		  width: 600px;
		  height: 600px;
		}
		td {
		  border: 1px solid black;
		  width: 10px;
		  height: 10px;
		  text-align: center;
		}
		.red {
		  background-color: red;
		}
		.green {
		  background-color: green;
		}
		.blue {
		  background-color: blue;
		}
		.yellow {
		  background-color: yellow;
		}
		.piece-slider img {
		  max-height: 30px;
		}
	  </style>
</head>
<body>
	<div style="display: flex;" id="all">
		<div class="grid-container" id="grid">
			<table style="border-collapse: collapse; width: 600px; height: 600px;">
				{% for i, row in enumerate(board.grid) %}
					<tr>
					{% for j, color in enumerate(row) %}
						<td class="square" data-x="{{ i }}" data-y="{{ j }}" value="{{ square }}" style="background-color: {{ color }}; width: 10px; height: 10px;"></td>
					{% endfor %}
					</tr>
				{% endfor %}
			  </table>
		</div>
		<div class="piece-list">
			<form method="post" action="{{ url_for('place') }}", id="pieces">
			  <input type="hidden" id="x" name="x" value="">
			  <input type="hidden" id="y" name="y" value="">
			  <input type="hidden" id="name" name="name" value="">
			  <label for="piece">Select a piece:</label>
			  {% for piece in pieces %}
			  <li style="display: block; margin-right: 10px;">
				<input type="radio" id="{{ piece.name }}" name="piece" value="{{ piece.name }}">
				<label for="{{ piece.name }}"><img src="{{ url_for('static', filename='pics/' + piece.name + '.png') }}" alt="{{ piece.name }}" style="height: 30px;"></label>
			  </li>
			  {% endfor %}
			</form>
		  </div>		  
	</div>
	<script>

		// Declare a variable to store the selected piece name
		let selectedPiece = ''
		// Get the form element with id="pieces"
		const form = document.getElementById('pieces');
		// Add a change event listener to the form element
		form.addEventListener('click', (event) => {
		// Check if the changed element is a radio item
		if (event.target.type === 'radio') {
			// Get the selected piece name from the radio buttons
			selectedPiece = event.target.value;
			// Set the selected piece name in the hidden input element with id="name"
			document.getElementById('name').value = selectedPiece;
		}
		});

		const grid = document.getElementById('grid');
		// Select the grid element and add a click event listener to it
		grid.addEventListener('mouseover', (event) => {
		// Check if the clicked element is a square elements
		if (event.target.classList.contains('square')) {
			// Get the x and y coordinates from the square's data attributes
			const x = event.target.getAttribute('data-x');
			const y = event.target.getAttribute('data-y');

			// Set the x and y input values in the form
			document.getElementById('x').value = x;
			document.getElementById('y').value = y;

			// Set the selected piece name in the hidden input element with id="name"
			// document.getElementById('name').value = selectedPiece;
			
			// // Get the selected piece name from the radio buttons
			// const selectedPiece = document.querySelector('input[name="piece"]:checked').value;
			// // Set the selected piece name in the hidden input element with id="name"
			document.getElementById('name').value = selectedPiece;

			// Submit the form programmatically to the /place endpoint
			    // Submit the form programmatically to the /place endpoint
			fetch('/hover', {
				method: 'POST',
				body: new FormData(form),
				}).then(response => {
				// Get the response as a text file
				return response.text();
				}).then(data => {
				// Update the grid element with id="grid" with the HTML data
				grid.innerHTML = data;
				}).catch(error => {
			// Handle the error as needed
			});
		}
		});
		



		// Select the grid element and add a click event listener to it
		grid.addEventListener('click', (event) => {
		// Check if the clicked element is a square element
		if (event.target.classList.contains('square')) {
			// Get the x and y coordinates from the square's data attributes
			const x = event.target.getAttribute('data-x');
			const y = event.target.getAttribute('data-y');

			// Set the x and y input values in the form
			document.getElementById('x').value = x;
			document.getElementById('y').value = y;

			// Set the selected piece name in the hidden input element with id="name"
			// document.getElementById('name').value = selectedPiece;
			
			// // Get the selected piece name from the radio buttons
			// const selectedPiece = document.querySelector('input[name="piece"]:checked').value;
			// // Set the selected piece name in the hidden input element with id="name"
			document.getElementById('name').value = selectedPiece;

			// Submit the form programmatically to the /place endpoint
			    // Submit the form programmatically to the /place endpoint
			fetch('/place', {
				method: 'POST',
				body: new FormData(form),
				}).then(response => {
				// Get the response as a text file
				return response.text();
				}).then(data => {
				// Update the grid element with id="grid" with the HTML data
				grid.innerHTML = data;

				document.getElementById('pieces').innerHTML = ''
				// No need to update the radio inputs since they are already rendered by the template

				document.getElementById('x').value = '';
				document.getElementById('y').value = '';

				// Reset the form element with id="form" to its default values
				document.getElementById('form').reset();
			// No need to update the radio inputs since they are already rendered by the template
				}).catch(error => {
			// Handle the error as needed
			});
		}
		});


	</script>
	
</body>
</html>





